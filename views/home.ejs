<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div id="kakaoMap" style="width: 100%; height: 400px;"></div>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d698315979c98f65a32752dc88bd959d"></script>

    <div id='restareaList' style="width: 100%; height: 400px; overflow: scroll; overflow-x: hidden">
      <form id='restareaForm' action="/restAreaInfo">
        <ul id='listItems'>
            <!-- 휴게소 목록 리스트 -->
        </ul>
      </form>
    </div>
    <div id='homeBtn' style='width:100%; height:50px; margin-top:20px;'>
        <button id='btnInfo'>휴게소정보</button>
        <button id='btnOrder'>음식주문</button>
    </div>
  </body>
</html>

<!-- home 화면 로딩 되면, 휴게소좌표 찍기위해서 데이터 요청 -->
<script>
    $.ajax({
        url: '/requestRestAreaLatLong',
        type: 'POST',
        success: function(data) {
            const results = JSON.parse(data);
            // console.log(result);
            drawList(results);
            drawMarker(results);
        }
    })

    // 휴게소 목록 리스트 그리기
    function drawList(results) {
        const form = document.getElementById('restareaForm');
        const ul = document.getElementById('listItems');
        const submit = document.createElement('input');
        submit.type = 'submit';
        submit.value = '휴게소 정보';
        
        for(i in results) {
            const li = document.createElement('li');

            const label = document.createElement('label');
            label.for = results[i].area_code;
            label.innerHTML = results[i].area_nm;

            const input = document.createElement('input');
            input.type = 'radio';
            input.id = results[i].area_code;
            input.name = 'area_code';
            input.value = results[i].area_code;

            const br = document.createElement('br');

            li.appendChild(label);
            li.appendChild(input);
            ul.appendChild(li);
            ul.appendChild(br);
        }
        form.appendChild(submit);
    }

    // 지도그리기
    function drawMarker(data) {
    var data = data;
    // var mapContainer = document.createElement("div");
    var mapContainer = document.getElementById("kakaoMap");
    var mapOption = {
        center: new kakao.maps.LatLng(37.5677463677699,126.9153946742084), //지도의 중심좌표
        level: 10
    };
    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도 생성 및 객체 리턴
    
    // 휴게소 좌표 - 마커표시
    for(var i in data) {
        var areaInfo = {
            name: data[i].area_nm,
            code: data[i].area_code,
            latitude: data[i].latitude,
            longitude: data[i].longitude,
        }
        // console.log(areaInfo);

        var marker = new kakao.maps.Marker({
            map: map,
            position: new kakao.maps.LatLng(areaInfo.latitude, areaInfo.longitude),
            title: areaInfo.name
        });

        marker.setMap(map);
    }

    // 현재 입력받은 위치 - 마커표시
    if(navigator.geolocation) {
        navigator.geolocation.watchPosition(function(position){
            // 마커 커스텀
            var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png', // 마커이미지의 주소입니다    
                imageSize = new kakao.maps.Size(32, 30), // 마커이미지의 크기입니다
                imageOption = {offset: new kakao.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
      
            // 마커의 이미지정보를 가지고 있는 마커이미지를 생성합니다
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);

            let lat = position.coords.latitude,
                lon = position.coords.longitude;

            // 현재 위치를 중심으로 지도 생성
            map.setCenter(new kakao.maps.LatLng(lat, lon));

            // 마커 위치
            var markerPosition  = new kakao.maps.LatLng(lat, lon); 
            var marker = new kakao.maps.Marker({
                position:markerPosition,
                image: markerImage // 마커이미지 설정 
            });
            marker.setMap(map);
        });
    } else{
        let locPosition = new kakao.maps.LatLng(37.5677463677699,126.9153946742084);
        map.setCenter(locPosition);
    }
}

</script>